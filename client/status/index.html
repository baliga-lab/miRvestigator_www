<html>
  <head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
  <script language="JavaScript">

      var job_id = null;
      var polling_timer = null;


      function toggleVisible(id) {
          if (document.getElementById) {
              obj = document.getElementById(id);
              if (obj) {
                  if (obj.style.display == 'none') {
                      obj.style.display = '';
                  } else {
                      obj.style.display = 'none';
                  }
              }
          }
      }

      function parseQueryString() {
        var params = {};
        var e,
            a = /\+/g,  // Regex for replacing addition symbol with a space
            r = /([^&;=]+)=?([^&;]*)/g,
            d = function (s) { return decodeURIComponent(s.replace(a, " ")); },
            q = window.location.search.substring(1);

        while (e = r.exec(q))
          params[d(e[1])] = d(e[2]);

        return params
      }

      function poll() {
        if (job_id) {
          jQuery.ajax({
            url: "/miRvestigator/status?id=" + job_id,
            context: document.body,
            dataType: "json",
            success: function(status) {
              $("#status_output").append("<p>" + status.updated_at + " " + status.status + "</p>");
              if (status.status=="done") {
                clearInterval(polling_timer);
                window.location = "/results/" + job_id + "/";
              }
            },
            error: function(xmlHttpRequest, textStatus, errorThrown) {
              $("#status_output").append("<p>Error getting status: " + textStatus + "</p>");
            }
          });
        }
      }

      function stop_polling() {
        if (polling_timer) clearInterval(polling_timer);
      }

      window.onload=function() {
        var url = window.location.pathname;
        var m = url.match(/\/status\/([0-9a-fA-F\-]+)\//);
        if (m && m.length > 1) {
          job_id = m[1];
          if (job_id) {
            $("#job_id").append(job_id);
            $("#refresh_link").attr("href", "/status/" + job_id + "/");
            polling_timer = window.setInterval(function() {
              poll();
            }, 1000);
          }
        }
      }
  </script>

  <style>
    body { font-family: arial, sans-serif; }
  </style>

  <title>miRvestigator Framework: Detect the miRNAs Driving Co-Expression Signatures</title>
  </head>

  <body>
    <h1>Status</h1>
    <p><b>Job id:</b> <span id="job_id"></span>.</p>
    <p><a href="javascript:stop_polling()">stop polling</a>, <a href="javascript:poll()">poll</a>, <a id="refresh_link" href="#">refresh</a></p>
    <div id="status_output"></div>
    <p><a href="/">home</a></p>
  </body>
</html>
